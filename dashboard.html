<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📊 Dashboard - BlackXCard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%); color: #ffffff; min-height: 100vh; }
        .sidebar { background: rgba(0, 0, 0, 0.9); width: 250px; height: 100vh; position: fixed; padding: 2rem; border-right: 2px solid #ff4444; }
        .logo { font-size: 1.8rem; font-weight: bold; color: #ff4444; margin-bottom: 2rem; text-align: center; }
        .nav-links { list-style: none; }
        .nav-links li { margin-bottom: 1rem; }
        .nav-links a { color: #ffffff; text-decoration: none; display: block; padding: 10px; border-radius: 5px; transition: background 0.3s; }
        .nav-links a:hover { background: rgba(255, 68, 68, 0.2); }
        .main-content { margin-left: 250px; padding: 2rem; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .balance-card { background: rgba(255, 68, 68, 0.1); padding: 2rem; border-radius: 15px; border: 1px solid #ff4444; margin-bottom: 2rem; }
        .balance-amount { font-size: 2.5rem; font-weight: bold; color: #44ff44; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
        .card { background: rgba(255, 255, 255, 0.05); padding: 2rem; border-radius: 15px; border: 1px solid rgba(255, 68, 68, 0.3); }
        .card h3 { color: #ff4444; margin-bottom: 1rem; }
        .buy-btn { background: linear-gradient(45deg, #ff4444, #ff8844); color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; }
        .owner-panel { background: rgba(255, 215, 0, 0.1); padding: 2rem; border-radius: 15px; border: 1px solid gold; margin-top: 2rem; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; }
        .modal-content { background: #1a1a1a; margin: 10% auto; padding: 2rem; border-radius: 15px; width: 90%; max-width: 500px; border: 2px solid #ff4444; }
    </style>
</head>
<body>
    <!-- SIDEBAR -->
    <div class="sidebar">
        <div class="logo">🃏 BlackXCard</div>
        <ul class="nav-links">
            <li><a href="#" onclick="showSection('dashboard')">📊 Dashboard</a></li>
            <li><a href="#" onclick="showSection('buyCards')">🛒 Buy Cards</a></li>
            <li><a href="#" onclick="showSection('addFund')">💰 Add Fund</a></li>
            <li><a href="#" onclick="showSection('purchaseHistory')">📋 Purchase History</a></li>
            <!-- OWNER ONLY LINKS -->
            <li id="ownerLinks" style="display: none;">
                <a href="#" onclick="showSection('addCC')">➕ Add CC</a>
                <a href="#" onclick="showSection('generateCode')">💎 Generate Code</a>
            </li>
            <li><a href="#" onclick="logout()">🚪 Logout</a></li>
        </ul>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
        <div class="header">
            <h1 id="sectionTitle">Dashboard</h1>
            <div id="userInfo">Welcome, <span id="usernameDisplay"></span></div>
        </div>

        <!-- DASHBOARD SECTION -->
        <div id="dashboardSection">
            <div class="balance-card">
                <h3>Your Balance</h3>
                <div class="balance-amount">$<span id="balanceDisplay">0</span></div>
            </div>
            
            <div class="card">
                <h3>📈 Quick Stats</h3>
                <p>Total Cards Purchased: <span id="totalPurchases">0</span></p>
                <p>Account Created: <span id="accountDate"></span></p>
                <p>Member Status: <span id="memberStatus">Regular</span></p>
            </div>
        </div>

        <!-- BUY CARDS SECTION -->
        <div id="buyCardsSection" style="display: none;">
            <h2>Available Cards</h2>
            <div class="card-grid" id="cardsContainer">
                <!-- Cards will be loaded here -->
            </div>
        </div>

        <!-- ADD FUND SECTION -->
        <div id="addFundSection" style="display: none;">
            <div class="card">
                <h3>💳 Redeem Credit Code</h3>
                <input type="text" id="creditCode" placeholder="Enter credit code" style="width: 100%; padding: 10px; margin: 10px 0; background: rgba(255,255,255,0.1); color: white; border: 1px solid #333; border-radius: 5px;">
                <button class="buy-btn" onclick="redeemCode()">Redeem Code</button>
            </div>
            
            <div class="card">
                <h3>📞 Contact for Buying Credit</h3>
                <p>Direct contact for bulk credit purchase:</p>
                <div style="margin: 15px 0;">
                    <a href="https://t.me/BlackXCarding" target="_blank" style="color: #ff4444; display: block; margin: 10px 0;">📱 Telegram: @BlackXCarding</a>
                    <a href="https://wa.me/+13435060103" target="_blank" style="color: #ff4444; display: block; margin: 10px 0;">📞 WhatsApp: +13435060103</a>
                </div>
            </div>
        </div>

        <!-- PURCHASE HISTORY SECTION -->
        <div id="purchaseHistorySection" style="display: none;">
            <div class="card">
                <h3>Your Purchase History</h3>
                <div id="purchaseHistory">
                    <!-- Purchase history will be loaded here -->
                </div>
            </div>
        </div>

        <!-- OWNER: ADD CC SECTION -->
        <div id="addCCSection" style="display: none;">
            <div class="owner-panel">
                <h3>👑 Add New Credit Card</h3>
                <input type="text" id="ccNumber" placeholder="Card Number (16 digits)" maxlength="16" style="width: 100%; padding: 10px; margin: 5px 0; background: rgba(255,255,255,0.1); color: white; border: 1px solid #333; border-radius: 5px;">
                <input type="text" id="ccExpiry" placeholder="MM/YY" maxlength="5" style="width: 100%; padding: 10px; margin: 5px 0; background: rgba(255,255,255,0.1); color: white; border: 1px solid #333; border-radius: 5px;">
                <input type="text" id="ccCVV" placeholder="CVV" maxlength="3" style="width: 100%; padding: 10px; margin: 5px 0; background: rgba(255,255,255,0.1); color: white; border: 1px solid #333; border-radius: 5px;">
                <input type="text" id="ccName" placeholder="Cardholder Name" style="width: 100%; padding: 10px; margin: 5px 0; background: rgba(255,255,255,0.1); color: white; border: 1px solid #333; border-radius: 5px;">
                <input type="number" id="ccPrice" placeholder="Price ($)" style="width: 100%; padding: 10px; margin: 5px 0; background: rgba(255,255,255,0.1); color: white; border: 1px solid #333; border-radius: 5px;">
                <button class="buy-btn" onclick="addCC()">Add Card</button>
            </div>
        </div>

        <!-- OWNER: GENERATE CODE SECTION -->
        <div id="generateCodeSection" style="display: none;">
            <div class="owner-panel">
                <h3>💎 Generate Credit Codes</h3>
                <input type="number" id="codeAmount" placeholder="Credit Amount ($)" style="width: 100%; padding: 10px; margin: 5px 0; background: rgba(255,255,255,0.1); color: white; border: 1px solid #333; border-radius: 5px;">
                <input type="number" id="codeQuantity" placeholder="Number of Codes" style="width: 100%; padding: 10px; margin: 5px 0; background: rgba(255,255,255,0.1); color: white; border: 1px solid #333; border-radius: 5px;">
                <button class="buy-btn" onclick="generateCodes()">Generate Codes 💎</button>
                
                <div id="generatedCodes" style="margin-top: 20px; background: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px; display: none;">
                    <h4>Generated Codes:</h4>
                    <div id="codesList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize data storage
        let currentUser = localStorage.getItem('currentUser');
        let users = JSON.parse(localStorage.getItem('blackxcard_users')) || [];
        let cards = JSON.parse(localStorage.getItem('blackxcard_cards')) || [];
        let creditCodes = JSON.parse(localStorage.getItem('blackxcard_codes')) || [];
        let purchases = JSON.parse(localStorage.getItem('blackxcard_purchases')) || [];
        
        // Redirect if not logged in
        if(!currentUser) {
            window.location.href = 'index.html';
        }

        // Check if owner
        const isOwner = currentUser === "BlinkOP";
        
        // Initialize on load
        window.onload = function() {
            document.getElementById('usernameDisplay').textContent = currentUser;
            updateBalance();
            showSection('dashboard');
            
            // Show owner links if owner
            if(isOwner) {
                document.getElementById('ownerLinks').style.display = 'block';
            }
            
            // Load user account date
            const user = users.find(u => u.username === currentUser);
            if(user) {
                document.getElementById('accountDate').textContent = user.joined || 'Today';
            }
        };

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('[id$="Section"]').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(sectionName + 'Section').style.display = 'block';
            document.getElementById('sectionTitle').textContent = sectionName.charAt(0).toUpperCase() + sectionName.slice(1).replace(/([A-Z])/g, ' $1');
            
            // Load specific section data
            if(sectionName === 'buyCards') {
                loadCards();
            } else if(sectionName === 'purchaseHistory') {
                loadPurchaseHistory();
            }
        }

        function updateBalance() {
            const user = users.find(u => u.username === currentUser);
            if(user) {
                document.getElementById('balanceDisplay').textContent = user.balance || 0;
            }
        }

        function loadCards() {
            const container = document.getElementById('cardsContainer');
            container.innerHTML = '';
            
            if(cards.length === 0) {
                container.innerHTML = '<div class="card"><h3>No Cards Available</h3><p>Owner will add cards soon</p></div>';
                return;
            }
            
            cards.forEach(card => {
                const cardElement = `
                    <div class="card">
                        <h3>💳 ${card.type || 'Premium'} Card</h3>
                        <p><strong>Number:</strong> ${card.number}</p>
                        <p><strong>Expiry:</strong> ${card.expiry}</p>
                        <p><strong>Name:</strong> ${card.name}</p>
                        <div style="font-size: 1.5rem; color: #44ff44; margin: 1rem 0;">$${card.price}</div>
                        <button class="buy-btn" onclick="buyCard('${card.id}')">Purchase Now</button>
                    </div>
                `;
                container.innerHTML += cardElement;
            });
        }

        function buyCard(cardId) {
            const card = cards.find(c => c.id === cardId);
            const user = users.find(u => u.username === currentUser);
            
            if(!user) return;
            
            if(user.balance < card.price) {
                alert('Insufficient balance! Please add funds.');
                showSection('addFund');
                return;
            }
            
            if(confirm(`Purchase this card for $${card.price}?`)) {
                // Deduct balance
                user.balance -= card.price;
                localStorage.setItem('blackxcard_users', JSON.stringify(users));
                
                // Add to purchase history
                const purchase = {
                    id: Date.now(),
                    username: currentUser,
                    cardNumber: card.number,
                    price: card.price,
                    date: new Date().toLocaleString()
                };
                purchases.push(purchase);
                localStorage.setItem('blackxcard_purchases', JSON.stringify(purchases));
                
                // Save card to cc.txt (simulated)
                saveCardToFile(card);
                
                alert(`✅ Purchase successful! Card details saved. Balance: $${user.balance}`);
                updateBalance();
                loadPurchaseHistory();
            }
        }

        function saveCardToFile(card) {
            // Simulate saving to cc.txt file
            const cardData = `${card.number}|${card.expiry}|${card.fullCVV}|${card.name}|${card.price}|${new Date().toLocaleString()}\n`;
            const existingData = localStorage.getItem('cc_txt_data') || '';
            localStorage.setItem('cc_txt_data', existingData + cardData);
        }

        function redeemCode() {
            const codeInput = document.getElementById('creditCode').value;
            const user = users.find(u => u.username === currentUser);
            
            if(!codeInput) {
                alert('Please enter a code!');
                return;
            }
            
            const code = creditCodes.find(c => c.code === codeInput && !c.used);
            
            if(code) {
                // Mark code as used
                code.used = true;
                code.usedBy = currentUser;
                code.usedAt = new Date().toLocaleString();
                localStorage.setItem('blackxcard_codes', JSON.stringify(creditCodes));
                
                // Add balance to user
                user.balance += code.amount;
                localStorage.setItem('blackxcard_users', JSON.stringify(users));
                
                document.getElementById('creditCode').value = '';
                alert(`✅ Code redeemed! $${code.amount} added to your balance.`);
                updateBalance();
            } else {
                alert('Invalid or already used code!');
            }
        }

        function loadPurchaseHistory() {
            const container = document.getElementById('purchaseHistory');
            const userPurchases = purchases.filter(p => p.username === currentUser);
            
            if(userPurchases.length === 0) {
                container.innerHTML = '<p>No purchases yet.</p>';
                return;
            }
            
            container.innerHTML = userPurchases.map(purchase => `
                <div style="border-bottom: 1px solid #333; padding: 10px 0;">
                    <strong>Card: ${purchase.cardNumber}</strong><br>
                    Amount: $${purchase.price}<br>
                    Date: ${purchase.date}
                </div>
            `).join('');
        }

        // OWNER FUNCTIONS
        function addCC() {
            if(!isOwner) return;
            
            const number = document.getElementById('ccNumber').value;
            const expiry = document.getElementById('ccExpiry').value;
            const cvv = document.getElementById('ccCVV').value;
            const name = document.getElementById('ccName').value;
            const price = document.getElementById('ccPrice').value;
            
            if(!number || !expiry || !cvv || !name || !price) {
                alert('Please fill all fields!');
                return;
            }
            
            if(number.length !== 16) {
                alert('Card number must be 16 digits!');
                return;
            }
            
            const newCard = {
                id: 'card_' + Date.now(),
                number: number.replace(/(\d{4})(\d{4})(\d{4})(\d{4})/, "$1********$4"),
                expiry: expiry,
                name: name.toUpperCase(),
                price: parseFloat(price),
                type: "Premium",
                fullNumber: number,
                fullCVV: cvv
            };
            
            cards.push(newCard);
            localStorage.setItem('blackxcard_cards', JSON.stringify(cards));
            
            // Clear form
            document.getElementById('ccNumber').value = '';
            document.getElementById('ccExpiry').value = '';
            document.getElementById('ccCVV').value = '';
            document.getElementById('ccName').value = '';
            document.getElementById('ccPrice').value = '';
            
            alert('✅ Card added successfully!');
        }

        function generateCodes() {
            if(!isOwner) return;
            
            const amount = parseInt(document.getElementById('codeAmount').value);
            const quantity = parseInt(document.getElementById('codeQuantity').value);
            
            if(!amount || !quantity) {
                alert('Please enter both amount and quantity!');
                return;
            }
            
            const newCodes = [];
            for(let i = 0; i < quantity; i++) {
                const code = 'BXC-' + Math.random().toString(36).substr(2, 8).toUpperCase();
                newCodes.push({
                    code: code,
                    amount: amount,
                    used: false,
                    generatedBy: currentUser,
                    generatedAt: new Date().toLocaleString()
                });
            }
            
            creditCodes.push(...newCodes);
            localStorage.setItem('blackxcard_codes', JSON.stringify(creditCodes));
            
            // Display generated codes
            document.getElementById('generatedCodes').style.display = 'block';
            document.getElementById('codesList').innerHTML = newCodes.map(c => 
                `<div style="margin: 5px 0; padding: 5px; background: rgba(255,255,255,0.1); border-radius: 5px;">
                    <strong>${c.code}</strong> - $${c.amount}
                </div>`
            ).join('');
            
            alert(`✅ ${quantity} codes generated for $${amount} each!`);
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>